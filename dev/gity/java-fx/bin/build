#!/usr/bin/env bash

set -euo pipefail
DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd)"
cd "$DIR/.."

rm -rf *.class minimaljavafxapp lib
mkdir lib
cp "$FX_HOME"/*.dylib lib/

javac --module-path "$FX_HOME" \
      --add-modules javafx.controls \
      MinimalJavaFXApp.java
java -agentlib:native-image-agent=config-output-dir=./META-INF/native-image \
     --module-path "$FX_HOME" \
     --add-modules javafx.controls \
     --enable-native-access=javafx.graphics \
     MinimalJavaFXApp
native-image --module-path "$FX_HOME" \
             --add-modules javafx.controls \
             --enable-native-access=javafx.graphics \
             -H:NativeLinkerOption=-rpath \
             -H:NativeLinkerOption=@loader_path/lib \
             -H:NativeLinkerOption=-L"$DIR/../lib" \
             -H:NativeLinkerOption=-lglass \
             -H:NativeLinkerOption=-lprism_es2 \
             -H:NativeLinkerOption=-lprism_common \
             -H:NativeLinkerOption=-ljavafx_font \
             -H:NativeLinkerOption=-ljavafx_iio \
             -cp . MinimalJavaFXApp
